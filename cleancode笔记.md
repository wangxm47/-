### 7.4 给出异常发生的环境说明

* 应当提供足够的环境说明, 以便判断错误的来源和处所
* 应创建充分的错误信息,并和异常一起传递;
  * 在消息中包含失败的操作和失败类型

### 7.5 依调用者需要定义异常类

* 定义异常类时,最重要的是考虑它们如何被捕获

### 7.6 定义常规流程

* 常规情况下, 在代码顶端定义一个处理器来应付任何失败了的运算
* 特殊情况下, 使用特例模式.
  * 创建一个类或者配置一个对象用来处理特例

### 7.7  别返回null值

* 返回null值,基本上是在给自己增加工作量,也是在给调用者添乱。只要有一处没检查null值，应用程序就会失控

### 7.8 别传递null值

* 恰当的做法是禁止传入null值

### 7.9 总结

整洁代码是可读的，但也要强固。可读和强固并不冲突。如果将错误处理隔离看待，独立于主要逻辑之外，就能写出强固而整洁的代码，也极大地提高了代码的可维护性。

## 8. 边界

本章将介绍如何将外来代码干净利落地整合进自己的代码中

### 8.1 使用第三方代码

* 第三方代码追求普适性，往往与使用者的特定需求间存在张力导致系统边界上的问题
* 一般做法是将边界接口(即第三方代码)封装隐藏起来。但最好的做法是不要将边界接口在系统中传递，如果使用边界接口就把它保留在类或近亲类中，避免从公共API中返回边界接口，或将边界接口作为参数传递给公共API

### 8.2 浏览和学习边界

* 为要使用的第三方代码编写测试
* TODO

### 8.3 TODO

### 8.4 学习性测试的好处不只是免费

* 学习性测试毫无成本
* 学习性测试是一种精确试验，帮助增进对API的理解
* 当第三方程序包发布了新版本时，可以通过运行学习性测试观察程序包行为有没有改变
* 学习性测试确保第三方程序包按照需求工作
* 无论是否通过学习性测试学习，总要有一系列边界测试来减轻迁移压力，否则可能回超出应有时限长久绑定在旧版本上

### 8.5 使用尚不存在的代码

* 将希望得到的接口隔离出来置于控制之下，再通过Adapter来跨接边界接口。好处是方便且不用考虑第三方代码的设计

### 8.6 整洁的边界

* 边界上的代码需要清晰的分割和定义了期望的测试。
* 应避免过多地了解第三方代码中的特定信息，依靠能控制的东西，好过依靠不能控制的东西，免得日后受它控制

### 8.7 总结

本章主要讲解了如何在项目中管理第三方代码，宗旨是不要依靠不能控制的东西，以免修改时代价太大。一般处理方法有两种

* 将边界接口封装起来
* 使用**ADAPTER**模式将接口转换为第三方提供的接口

## 9. 单元测试

### 9.1 TDD三定律

* 定律一：在编写不能通过的单元测试前，不可编写生产代码
* 定律二：只可编写刚好无法通过的单元测试，不能编译也算不通过
* 定律三：只可编写刚好足以通过当前失败测试的生产代码

### 9.2 保持测试整洁

* 测试代码和生产代码一样重要，它该像生产代码一样保持整洁
* 测试带来一切好处，正是单元测试让代码可扩展，可维护，可复用。如果测试不能保持整洁，就会失去测试代码，没有了测试，保证生产代码可扩展的一切要素都会失去

### 9.3 整洁的测试

* 只有一个要素：**可读性**。在测试代码中可读性比生产代码中还重要
* 如何做到可读？和生产代码一样：明确，简洁和足够的表达力。在测试中要以尽可能少的文字表达大量内容

#### 9.3.1 面向特定领域的测试语言

* 测试语言：不直接使用操作系统的API，而是打造了一套包装这些API的函数和工具代码。这样能更方便地编写测试，也更便于阅读

#### 9.3.2 双重标准

* 有些事永远不会在生产环境中做，但在测试环境中却没有限制，这就是双重标准。但这通常关乎内存或CPU效率的问题，却**永远不会**与**整洁**有关。

### 9.4 每个测试一个断言

* 单个断言是个好准则，但最好的说法是单个测试中的断言数量应该最小化

* 更好一些的规则是每个测试函数中只测试一个概念

### 9.5 F.I.R.S.T.

* 整洁的测试还遵循一下五条准则
  * **快速(FAST)**: 测试应该够快。测试应该能快速运行。
  * **独立(Independent)**: 测试应该相互独立。
  * **可重复(Repeatable)**: 测试应当可在任何环境中重复通过。
  * **自足验证(Self-Validating)**: 测试应该有布尔值输出。
  * **及时(Timely)**: 测试应当及时编写。单元测试应当恰好在使其通过的生产代码之前编写

### 9.6 总结

本章节讲述了单元测试应当遵守的原则和编写整洁测试代码的方法，并着重表明在**TDD**中测试比生产更重要。

